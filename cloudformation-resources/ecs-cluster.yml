Resources:
  CryptoFeedsECSCluster:
    Type: AWS::ECS::Cluster
    Properties:
      ClusterName: ${self:service.name}-${self:provider.stage}-cryptofeeds
  CryptoFeedsECSCTaskDefinition:
    Type: AWS::ECS::TaskDefinition
    Properties:
      RequiresCompatibilities:
        - FARGATE
      ExecutionRoleArn: { Fn::GetAtt: CryptoFeedsECSCTaskExecutionRole.Arn }
      Cpu: 256
      Memory: 0.5GB
      NetworkMode: awsvpc
      ContainerDefinitions:
        - 
          Command:
            - sh
            - -c
            - 'while true; do echo "hey! I am the crypto-feed container"; sleep 5s; done'
          Image: alpine:3.7
          Name: crypto-feed
          Memory: 128
          LogConfiguration:
            LogDriver: awslogs
            Options:
              awslogs-group: { Ref: CryptoFeedsLogGroup }
              awslogs-region: eu-west-1
              awslogs-stream-prefix: cryptofeed
  CryptoFeedsLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: ${self:service.name}-${self:provider.stage}-cryptofeeds
      RetentionInDays: 1
  CryptoFeedsECSCTaskExecutionRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Effect: Allow
          Principal:
            Service: [ ecs-tasks.amazonaws.com ]
          Action: [ 'sts:AssumeRole' ]
      Path: /
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy
